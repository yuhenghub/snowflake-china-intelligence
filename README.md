# Snowflake ä¸­å›½åŒº Cortex Analyst è¯­ä¹‰æ¨¡å‹ç”Ÿæˆå™¨

[English Version](#english-version) | ä¸­æ–‡ç‰ˆ

> ä¸€å¥—å®Œæ•´çš„ Snowflake Cortex Analyst è¯­ä¹‰æ¨¡å‹ç”Ÿæˆå·¥å…·åŒ…ï¼Œä¸“ä¸º **Snowflake ä¸­å›½åŒº** ä¼˜åŒ–ï¼Œæä¾› Cortex LLM æ›¿ä»£æ–¹æ¡ˆã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ README.md                      # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ app.py                         # Semantic Model Generator ä¸»åº”ç”¨
â”œâ”€â”€ environment.yml                # ç¯å¢ƒé…ç½®
â”œâ”€â”€ pyproject.toml                 # Python ä¾èµ–
â”œâ”€â”€ Makefile                       # æ„å»ºè„šæœ¬
â”‚
â”œâ”€â”€ agent_intelligence/            # ğŸ‡¨ğŸ‡³ Cortex Agent V2 (ä¸­å›½åŒº)
â”‚   â”œâ”€â”€ cortex_agent_sis_v2.py     # ä¸»åº”ç”¨ (Streamlit in Snowflake)
â”‚   â”œâ”€â”€ environment.yml            # SiS ä¾èµ–
â”‚   â”œâ”€â”€ setup_qwen_udf.sql         # UDF éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ README.md                  # ä½¿ç”¨è¯´æ˜
â”‚
â”œâ”€â”€ spcs_china/                    # ğŸ‡¨ğŸ‡³ è‡ªæ‰˜ç®¡ LLM (SPCS)
â”‚   â”œâ”€â”€ model_service/             # å®¹å™¨æœåŠ¡ä»£ç 
â”‚   â”œâ”€â”€ setup_sql/                 # SQL è®¾ç½®è„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh                  # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ README.md                  # è¯¦ç»†æ–‡æ¡£
â”‚
â”œâ”€â”€ semantic_model_generator/      # è¯­ä¹‰æ¨¡å‹ç”Ÿæˆæ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ data_processing/           # æ•°æ®å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ protos/                    # Protocol Buffers å®šä¹‰
â”‚   â”œâ”€â”€ snowflake_utils/           # Snowflake è¿æ¥å’Œ LLM å·¥å…·
â”‚   â””â”€â”€ validate/                  # æ¨¡å‹éªŒè¯é€»è¾‘
â”‚
â”œâ”€â”€ sis_setup/                     # Streamlit in Snowflake éƒ¨ç½² SQL
â”œâ”€â”€ journeys/                      # ç”¨æˆ·å·¥ä½œæµ
â”œâ”€â”€ partner/                       # åˆä½œä¼™ä¼´é›†æˆ (dbt, Looker)
â”œâ”€â”€ app_utils/                     # å…±äº«å·¥å…·
â””â”€â”€ images/                        # å›¾ç‰‡èµ„æº
```

---

## ğŸ“Œ èƒŒæ™¯

### æ–¹æ¡ˆä»·å€¼

æœ¬é¡¹ç›®ä¸º **Snowflake ä¸­å›½åŒºå®¢æˆ·** æä¾›å®Œæ•´çš„ AI èƒ½åŠ›è§£å†³æ–¹æ¡ˆï¼š

- âœ… **Cortex LLM æ›¿ä»£**ï¼šä¸­å›½åŒº Cortex LLM ä¸Šçº¿å‰çš„è¿‡æ¸¡æ–¹æ¡ˆ
- âœ… **æ•°æ®åˆè§„**ï¼šæ”¯æŒæœ¬åœ°åŒ–éƒ¨ç½²ï¼Œæ•°æ®ä¸å‡ºå¢ƒ
- âœ… **æ— ç¼é›†æˆ**ï¼šé€šè¿‡ UDF æä¾›ä¸ Cortex LLM ç±»ä¼¼çš„è°ƒç”¨ä½“éªŒ
- âœ… **å¤šæ¨¡å‹æ”¯æŒ**ï¼šæ”¯æŒé€šä¹‰åƒé—®ã€DeepSeekã€Moonshot ç­‰å¤šä¸ª LLM æä¾›å•†
- âœ… **åˆä½œä¼™ä¼´é›†æˆ**ï¼šæ”¯æŒä» dbt å’Œ Looker å¯¼å…¥è¯­ä¹‰æ¨¡å‹

### è§£å†³æ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Snowflake ä¸­å›½åŒº AI è§£å†³æ–¹æ¡ˆ                              â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      æ–¹æ¡ˆä¸€: å¤–éƒ¨ API                                â”‚   â”‚
â”‚   â”‚     é€šè¿‡ UDF è°ƒç”¨ DashScope (Qwen) / DeepSeek / Moonshot API         â”‚   â”‚
â”‚   â”‚                    â†“                                                 â”‚   â”‚
â”‚   â”‚     é€‚ç”¨åœºæ™¯: å¿«é€Ÿé›†æˆã€æ—  GPU éœ€æ±‚                                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      æ–¹æ¡ˆäºŒ: SPCS è‡ªæ‰˜ç®¡                             â”‚   â”‚
â”‚   â”‚     åœ¨ Snowflake Container Services ä¸­éƒ¨ç½²å¼€æº LLM æ¨¡å‹              â”‚   â”‚
â”‚   â”‚                    â†“                                                 â”‚   â”‚
â”‚   â”‚     é€‚ç”¨åœºæ™¯: æ•°æ®ä¸å‡ºå¢ƒã€å®Œå…¨ç§æœ‰åŒ–éƒ¨ç½²                               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Snowflake China Region                               â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     ç”¨æˆ·åº”ç”¨å±‚ (User Applications)                    â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚  â”‚  Streamlit App  â”‚  â”‚  SQL Worksheet  â”‚  â”‚  BI Tools           â”‚  â”‚   â”‚
â”‚   â”‚  â”‚  (SiS)          â”‚  â”‚                 â”‚  â”‚  (Tableau, etc.)    â”‚  â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚                    â”‚                     â”‚                   â”‚
â”‚               â–¼                    â–¼                     â–¼                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     è¯­ä¹‰æ¨¡å‹ (Semantic Model)                        â”‚   â”‚
â”‚   â”‚     å­˜å‚¨åœ¨ Stage ä¸­çš„ YAML æ–‡ä»¶ï¼Œå®šä¹‰æ•°æ®ç»´åº¦ã€åº¦é‡å’Œå…³ç³»              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                        â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚               â–¼                     â”‚                     â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚    å¤–éƒ¨ API æ–¹æ¡ˆ       â”‚         â”‚         â”‚    SPCS è‡ªæ‰˜ç®¡æ–¹æ¡ˆ     â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚ QWEN_COMPLETE   â”‚  â”‚         â”‚         â”‚  â”‚ QWEN_COMPLETE   â”‚  â”‚     â”‚
â”‚   â”‚  â”‚ UDF             â”‚  â”‚         â”‚         â”‚  â”‚ Service Function â”‚ â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚           â”‚           â”‚         â”‚         â”‚           â”‚           â”‚     â”‚
â”‚   â”‚           â–¼           â”‚         â”‚         â”‚           â–¼           â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚ External Access â”‚  â”‚         â”‚         â”‚  â”‚ SPCS Container  â”‚  â”‚     â”‚
â”‚   â”‚  â”‚ Integration     â”‚  â”‚         â”‚         â”‚  â”‚ (GPU + vLLM)    â”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚           â”‚           â”‚         â”‚         â”‚                       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚                     â”‚                                        â”‚
â”‚               â–¼                     â”‚                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                                        â”‚
â”‚   â”‚   å¤–éƒ¨ LLM API        â”‚         â”‚                                        â”‚
â”‚   â”‚  - DashScope (Qwen)   â”‚         â”‚                                        â”‚
â”‚   â”‚  - DeepSeek           â”‚         â”‚                                        â”‚
â”‚   â”‚  - Moonshot           â”‚         â”‚                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶è¯´æ˜

| ç»„ä»¶ | è¯´æ˜ | æ–‡æ¡£ |
|-----|------|------|
| **Semantic Model Generator** | ä» Snowflake è¡¨è‡ªåŠ¨ç”Ÿæˆè¯­ä¹‰æ¨¡å‹ | [sis_setup/](./sis_setup/) |
| **Cortex Agent V2** | åŸºäºè¯­ä¹‰æ¨¡å‹çš„æ™ºèƒ½é—®ç­”åº”ç”¨ | [agent_intelligence/](./agent_intelligence/) |
| **SPCS è‡ªæ‰˜ç®¡ LLM** | åœ¨ SPCS ä¸­éƒ¨ç½² Qwen æ¨¡å‹ | [spcs_china/](./spcs_china/) |

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. è¯­ä¹‰æ¨¡å‹ç”Ÿæˆå™¨ (Semantic Model Generator)

| åŠŸèƒ½ | è¯´æ˜ |
|-----|------|
| **è‡ªåŠ¨ç”Ÿæˆ** | ä» Snowflake è¡¨/è§†å›¾è‡ªåŠ¨ç”Ÿæˆè¯­ä¹‰æ¨¡å‹ |
| **åˆä½œä¼™ä¼´å¯¼å…¥** | ä» dbt Semantic Model æˆ– Looker Explore å¯¼å…¥ |
| **AI å¢å¼ºæè¿°** | ä½¿ç”¨ LLM è‡ªåŠ¨ç”Ÿæˆå­—æ®µæè¿° |
| **æ¨¡å‹éªŒè¯** | éªŒè¯è¯­ä¹‰æ¨¡å‹æ˜¯å¦ç¬¦åˆè§„èŒƒ |
| **å¯è°ƒç”¨ API** | é€šè¿‡å­˜å‚¨è¿‡ç¨‹ç”Ÿæˆæ¨¡å‹ |

### 2. Cortex Agent V2 (ä¸­å›½åŒº)

ç”±äº Cortex LLM åœ¨ä¸­å›½åŒºæš‚ä¸å¯ç”¨ï¼Œæœ¬é¡¹ç›®æä¾›æ›¿ä»£æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|-----|------|---------|
| **å¤–éƒ¨ API** | é€šè¿‡ UDF è°ƒç”¨ DashScope/DeepSeek/Moonshot API | å¿«é€Ÿé›†æˆã€æ—  GPU éœ€æ±‚ |
| **SPCS è‡ªæ‰˜ç®¡** | åœ¨ SPCS ä¸­éƒ¨ç½² Qwen æ¨¡å‹ | æ•°æ®ä¸å‡ºå¢ƒã€å®Œå…¨ç§æœ‰åŒ– |

**æ”¯æŒçš„ LLM æä¾›å•†:**

| æä¾›å•† | æ¨¡å‹ | API ç«¯ç‚¹ |
|-------|------|---------|
| DashScope (é€šä¹‰åƒé—®) | `qwen-max`, `qwen-plus`, `qwen-turbo` | dashscope.aliyuncs.com |
| DeepSeek | `deepseek-chat`, `deepseek-reasoner` | api.deepseek.com |
| Moonshot (Kimi) | `moonshot-v1-8k`, `moonshot-v1-32k`, `moonshot-v1-128k` | api.moonshot.cn |

### 3. SPCS è‡ªæ‰˜ç®¡ LLM

å¯¹äºæœ‰æ•°æ®åˆè§„è¦æ±‚çš„åœºæ™¯ï¼Œåœ¨ Snowflake å†…éƒ¨ç½²å¼€æº LLMï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Snowflake China Region                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              QWEN_COMPLETE() UDF                     â”‚    â”‚
â”‚  â”‚         Service Function â†’ SPCS Endpoint             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           SPCS Container Service                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚   Proxy         â”‚â”€â”€â”€â–¶â”‚  Qwen2.5 Model (GPU)    â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  (:8001)        â”‚    â”‚  vLLM Inference (:8000) â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿:**
- âœ… æ•°æ®ä¸å‡º Snowflake
- âœ… å®Œå…¨æ§åˆ¶æ¨¡å‹é€‰æ‹©
- âœ… æ— å¤–éƒ¨ API ä¾èµ–
- âœ… ç¬¦åˆä¸­å›½æ•°æ®åˆè§„è¦æ±‚

---

## ğŸ“‹ å…ˆå†³æ¡ä»¶

### Snowflake ç¯å¢ƒè¦æ±‚

| è¦æ±‚ | è¯´æ˜ |
|-----|------|
| **Snowflake è´¦æˆ·** | Snowflake ä¸­å›½åŒºè´¦æˆ· |
| **è§’è‰²æƒé™** | ACCOUNTADMINï¼ˆåˆ›å»ºå¤–éƒ¨è®¿é—®é›†æˆã€è®¡ç®—æ± ç­‰ï¼‰|
| **SPCS åŠŸèƒ½** | (å¯é€‰) å¦‚éœ€è‡ªæ‰˜ç®¡ LLMï¼Œéœ€å¯ç”¨ SPCS |
| **GPU é…é¢** | (å¯é€‰) å¦‚éœ€è‡ªæ‰˜ç®¡ LLMï¼Œéœ€æœ‰ GPU é…é¢ |

### å¤–éƒ¨ API è¦æ±‚

| æä¾›å•† | è·å– API Key |
|-------|-------------|
| DashScope | [é˜¿é‡Œäº‘ DashScope æ§åˆ¶å°](https://dashscope.console.aliyun.com/) |
| DeepSeek | [DeepSeek å¼€æ”¾å¹³å°](https://platform.deepseek.com/) |
| Moonshot | [Moonshot å¼€æ”¾å¹³å°](https://platform.moonshot.cn/) |

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

| å·¥å…· | ç‰ˆæœ¬è¦æ±‚ | ç”¨é€” |
|-----|---------|------|
| **Python** | 3.9 - 3.11 | æœ¬åœ°å¼€å‘ |
| **Snow CLI** | æœ€æ–°ç‰ˆ | éƒ¨ç½²åº”ç”¨ |
| **Docker** | 20.10+ | (å¯é€‰) SPCS é•œåƒæ„å»º |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ¡ˆä¸€: éƒ¨ç½²è¯­ä¹‰æ¨¡å‹ç”Ÿæˆå™¨ (Streamlit in Snowflake)

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/semantic-model-generator-china.git
cd semantic-model-generator-china

# 2. éƒ¨ç½²åˆ° Streamlit in Snowflake
snow sql -f sis_setup/app_setup.sql --connection your_connection

# 3. æ‰“å¼€åº”ç”¨
snow streamlit get-url SEMANTIC_MODEL_GENERATOR --open \
    --database cortex_analyst_semantics \
    --schema semantic_model_generator \
    --connection your_connection
```

### æ–¹æ¡ˆäºŒ: éƒ¨ç½² Cortex Agent V2 (å¤–éƒ¨ API)

1. **ç¼–è¾‘ UDF éƒ¨ç½²è„šæœ¬** - ä¿®æ”¹ `agent_intelligence/setup_qwen_udf.sql`:

```sql
-- âš ï¸ æ›¿æ¢ä¸ºä½ çš„é€šä¹‰åƒé—® API Key
SET QWEN_API_KEY = '<YOUR_QWEN_API_KEY>';
```

2. **æ‰§è¡Œ SQL è„šæœ¬** - åœ¨ Snowsight ä¸­æ‰§è¡Œ:

```sql
-- æ‰§è¡Œ agent_intelligence/setup_qwen_udf.sql ä¸­çš„æ‰€æœ‰è¯­å¥
```

3. **éƒ¨ç½² Streamlit åº”ç”¨**:

```sql
-- åˆ›å»º Stage
CREATE STAGE YOUR_DB.YOUR_SCHEMA.AGENT_STAGE DIRECTORY = (ENABLE = true);

-- ä¸Šä¼ æ–‡ä»¶
PUT file://agent_intelligence/cortex_agent_sis_v2.py @YOUR_DB.YOUR_SCHEMA.AGENT_STAGE/ OVERWRITE = TRUE AUTO_COMPRESS = FALSE;
PUT file://agent_intelligence/environment.yml @YOUR_DB.YOUR_SCHEMA.AGENT_STAGE/ OVERWRITE = TRUE AUTO_COMPRESS = FALSE;

-- åˆ›å»º Streamlit åº”ç”¨
CREATE STREAMLIT YOUR_DB.YOUR_SCHEMA.CORTEX_AGENT_V2
    ROOT_LOCATION = '@YOUR_DB.YOUR_SCHEMA.AGENT_STAGE'
    MAIN_FILE = 'cortex_agent_sis_v2.py'
    TITLE = "Snowflake China Intelligence V2"
    QUERY_WAREHOUSE = YOUR_WAREHOUSE
    EXTERNAL_ACCESS_INTEGRATIONS = (qwen_api_integration);
```

### æ–¹æ¡ˆä¸‰: éƒ¨ç½² SPCS è‡ªæ‰˜ç®¡ LLM

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [spcs_china/README.md](./spcs_china/README.md)

```bash
cd spcs_china
./deploy.sh deploy
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### å¤–éƒ¨ API UDF è·¯å¾„

åœ¨ `agent_intelligence/cortex_agent_sis_v2.py` ä¸­é…ç½® LLM åç«¯ï¼š

```python
MODEL_BACKENDS = {
    "SPCS (Local)": {
        "udf_path": "SPCS_CHINA.MODEL_SERVICE.QWEN_COMPLETE"
    },
    "External API": {
        "udf_path": "YOUR_DB.YOUR_SCHEMA.QWEN_COMPLETE"
    }
}
```

### è¯­ä¹‰æ¨¡å‹å­˜å‚¨ä½ç½®

```python
DEFAULT_SEMANTIC_STAGE_PATH = "@YOUR_DB.YOUR_SCHEMA.SEMANTIC_MODELS"
```

---

## ğŸ¤ åˆä½œä¼™ä¼´é›†æˆ

| æ¥æº | æ–¹æ³• | è¦æ±‚ |
|-----|------|------|
| **dbt Semantic Model** | ä» dbt YAML æ–‡ä»¶æå–å’Œè½¬æ¢å…ƒæ•°æ® | dbt æ¨¡å‹éœ€ç‰©åŒ–åˆ° Snowflake |
| **dbt SQL Model** | ä»ç‰©åŒ–è¡¨ç”Ÿæˆï¼Œä½¿ç”¨ persist docs | - |
| **Looker Explore** | å°† Explore ç‰©åŒ–ä¸º Snowflake è¡¨ | éœ€è¦ Looker SDK å‡­æ® |

---

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€è°ƒç”¨

```sql
-- ç®€å•é—®ç­”
SELECT QWEN_COMPLETE('qwen-turbo', 'ä»€ä¹ˆæ˜¯æ•°æ®ä»“åº“ï¼Ÿ');

-- å¤æ‚ä»»åŠ¡
SELECT QWEN_COMPLETE('qwen-max', 
  'åˆ†æä»¥ä¸‹é”€å”®æ•°æ®è¶‹åŠ¿å¹¶ç»™å‡ºå»ºè®®: ' || 
  (SELECT TO_CHAR(ARRAY_AGG(OBJECT_CONSTRUCT(*))) FROM sales_summary)
);
```

### æ‰¹é‡å¤„ç†

```sql
-- æ‰¹é‡ç”Ÿæˆäº§å“æè¿°
SELECT 
    product_id,
    product_name,
    QWEN_COMPLETE('qwen-turbo', 
      'ä¸ºä»¥ä¸‹äº§å“ç”Ÿæˆç®€çŸ­çš„è¥é”€æè¿°: ' || product_name
    ) AS ai_description
FROM products
LIMIT 10;
```

### è¯­ä¹‰æ¨¡å‹ç¤ºä¾‹

```yaml
name: Sales Data
description: é”€å”®æ•°æ®è¯­ä¹‰æ¨¡å‹

tables:
  - name: sales_data
    description: æ¯æ—¥é”€å”®ä¿¡æ¯
    base_table:
      database: sales
      schema: public
      table: sd_data

    dimensions:
      - name: product_category
        synonyms: ["äº§å“ç±»åˆ«", "å•†å“åˆ†ç±»"]
        description: é”€å”®äº§å“çš„ç±»åˆ«
        expr: cat
        data_type: TEXT

    time_dimensions:
      - name: sale_timestamp
        description: é”€å”®å‘ç”Ÿæ—¶é—´ (UTC)
        expr: dt
        data_type: TIMESTAMP

    measures:
      - name: sales_amount
        synonyms: ["é”€å”®é¢", "è¥æ”¶"]
        description: æ€»é”€å”®é‡‘é¢
        expr: amt
        data_type: NUMBER
        default_aggregation: sum
```

---

## ğŸ’° æˆæœ¬ä¸æ€§èƒ½

### å¤–éƒ¨ API æ–¹æ¡ˆ

| æä¾›å•† | æ¨¡å‹ | ä»·æ ¼ (å‚è€ƒ) |
|-------|------|-----------|
| DashScope | qwen-turbo | Â¥0.008/1K tokens |
| DashScope | qwen-max | Â¥0.04/1K tokens |
| DeepSeek | deepseek-chat | Â¥0.001/1K tokens |

### SPCS è‡ªæ‰˜ç®¡æ–¹æ¡ˆ

| ç»„ä»¶ | è§„æ ¼ | ä¼°ç®—æˆæœ¬ (å‚è€ƒ) |
|-----|------|---------------|
| GPU è®¡ç®—æ±  | GPU_NV_S (T4 16GB) | ~$2-3/å°æ—¶ |
| å­˜å‚¨ | é•œåƒ + Stage | < $1/æœˆ |

**æˆæœ¬ä¼˜åŒ–å»ºè®®:**
- è®¾ç½® `AUTO_SUSPEND_SECS = 600` è‡ªåŠ¨æš‚åœ
- éå·¥ä½œæ—¶é—´æ‰‹åŠ¨æš‚åœæœåŠ¡

---

## ğŸ”§ è¿ç»´ç®¡ç†

### å¸¸ç”¨å‘½ä»¤

```sql
-- æŸ¥çœ‹ UDF çŠ¶æ€
SHOW FUNCTIONS LIKE 'QWEN_COMPLETE';

-- æµ‹è¯• UDF
SELECT QWEN_COMPLETE('qwen-turbo', 'ä½ å¥½');

-- æŸ¥çœ‹ SPCS æœåŠ¡çŠ¶æ€
SELECT SYSTEM$GET_SERVICE_STATUS('QWEN_MODEL_SERVICE');

-- æš‚åœ/æ¢å¤ SPCS æœåŠ¡
ALTER SERVICE QWEN_MODEL_SERVICE SUSPEND;
ALTER SERVICE QWEN_MODEL_SERVICE RESUME;
```

### æ•…éšœæ’é™¤

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|---------|---------|
| UDF è°ƒç”¨å¤±è´¥ | API Key æ— æ•ˆ | æ£€æŸ¥ Secret é…ç½® |
| å¤–éƒ¨è®¿é—®å¤±è´¥ | ç½‘ç»œè§„åˆ™æœªé…ç½® | æ£€æŸ¥ External Access Integration |
| SPCS å¯åŠ¨è¶…æ—¶ | æ¨¡å‹ä¸‹è½½æ…¢ | æ£€æŸ¥ç½‘ç»œè§„åˆ™ |
| GPU ä¸å¯ç”¨ | é…é¢ä¸è¶³ | è”ç³» Snowflake æ”¯æŒ |

---

## ğŸ“ æ€»ç»“

### æ–¹æ¡ˆä¼˜åŠ¿

âœ… **Cortex LLM æ›¿ä»£** - ä¸­å›½åŒºä¸Šçº¿å‰çš„å®Œæ•´è¿‡æ¸¡æ–¹æ¡ˆ

âœ… **çµæ´»é€‰æ‹©** - å¤–éƒ¨ API æˆ– SPCS è‡ªæ‰˜ç®¡ï¼Œæ»¡è¶³ä¸åŒéœ€æ±‚

âœ… **æ•°æ®åˆè§„** - SPCS æ–¹æ¡ˆç¡®ä¿æ•°æ®ä¸å‡ºå¢ƒ

âœ… **æ— ç¼é›†æˆ** - ä¸ Snowflake å·¥ä½œæµå®Œç¾é›†æˆ

âœ… **å¤šæ¨¡å‹æ”¯æŒ** - æ”¯æŒå¤šä¸ªä¸»æµ LLM æä¾›å•†

### é€‚ç”¨åœºæ™¯

- ä¸­å›½åŒºå®¢æˆ·éœ€è¦åœ¨ Snowflake ä¸­ä½¿ç”¨ AI èƒ½åŠ›
- éœ€è¦åŸºäºè¯­ä¹‰æ¨¡å‹è¿›è¡Œæ™ºèƒ½æ•°æ®åˆ†æ
- å¯¹æ•°æ®å®‰å…¨æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œä¸å…è®¸æ•°æ®å‡ºå¢ƒ
- ç­‰å¾… Cortex LLM ä¸­å›½åŒºä¸Šçº¿å‰çš„è¿‡æ¸¡æ–¹æ¡ˆ

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Snowflake Cortex Analyst æ–‡æ¡£](https://docs.snowflake.com/en/user-guide/snowflake-cortex/cortex-analyst)
- [Snowflake Container Services æ–‡æ¡£](https://docs.snowflake.com/en/developer-guide/snowpark-container-services/overview)
- [é€šä¹‰åƒé—® DashScope API](https://help.aliyun.com/zh/dashscope/)
- [Qwen2.5 æ¨¡å‹ä»‹ç»](https://github.com/QwenLM/Qwen2.5)

---

## ğŸ“„ License

Apache 2.0 License

---

## ğŸ¤ Contributing

æœ¬é¡¹ç›®æ˜¯ [Snowflake-Labs/semantic-model-generator](https://github.com/Snowflake-Labs/semantic-model-generator) çš„ä¸­å›½åŒºé€‚é…ç‰ˆæœ¬ã€‚

---

<a name="english-version"></a>
# English Version

# Semantic Model Generator for Snowflake China Region

A comprehensive toolkit for generating semantic models for Snowflake Cortex Analyst, with special adaptations for **Snowflake China Region** where Cortex LLM is not yet available.

## Overview

This project provides:

1. **Semantic Model Generator** - Generate and curate semantic models for Cortex Analyst
2. **Cortex Agent V2 (China)** - LLM-powered analytics using external APIs or self-hosted models
3. **SPCS Self-Hosted LLM** - Deploy open-source LLM models within Snowflake for data compliance

## Quick Start

See the Chinese documentation above for detailed instructions, or refer to:

- [agent_intelligence/README.md](./agent_intelligence/README.md) - Cortex Agent V2 setup
- [spcs_china/README.md](./spcs_china/README.md) - SPCS self-hosted LLM deployment

## License

Apache 2.0 License
